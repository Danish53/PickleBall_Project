<!-- group -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        #chatPage {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: beige;
        }

        #messageList {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }

        #messageInput, #sendMessageButton {
            padding: 10px;
        }

        #messageInput {
            width: calc(100% - 80px);
        }

        #sendMessageButton {
            width: 60px;
        }

        .notification {
            background-color: #ffef96;
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="chatPage">
        <h2>Group Chat</h2>
        <div id="messageList"></div>
        <input type="text" id="messageInput" placeholder="Type a message...">
        <button id="sendMessageButton">Send</button>
        <div id="notifications"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // const socket = io();
            const socket = io('http://localhost:8000');


            const messageList = document.getElementById('messageList');
            const messageInput = document.getElementById('messageInput');
            const sendMessageButton = document.getElementById('sendMessageButton');
            const notifications = document.getElementById('notifications');

            const groupId = prompt("Enter Group ID:", "58");
            const userPhoneNumber = prompt("Enter User phone number:", "423434786");

            socket.emit('joinGroup', { groupId, userPhoneNumber });

            socket.on('loadMessages', (messages) => {
                messageList.innerHTML = '';
                messages.forEach(msg => {
                    const messageElement = document.createElement('div');
                    messageElement.textContent = `${msg.userPhoneNumber}: ${msg.message}`;
                    messageList.appendChild(messageElement);
                });
            });

            socket.on('message', (msg) => {
                const messageElement = document.createElement('div');
                messageElement.textContent = `${msg.userPhoneNumber}: ${msg.message}`;
                messageList.appendChild(messageElement);
            });

            sendMessageButton.addEventListener('click', () => {
                const message = messageInput.value;
                if (message.trim() !== '') {
                    socket.emit('sendMessage', { groupId, userPhoneNumber, message });
                    messageInput.value = '';
                }
            });

            socket.on('notification', (notification) => {
                const notificationElement = document.createElement('div');
                notificationElement.className = 'notification';
                notificationElement.textContent = `New message in group ${notification.groupId}: ${notification.message.message}`;
                notifications.appendChild(notificationElement);
            });
        });
    </script>
</body>
</html> -->

<!-- one to one chat -->
<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Private Chat</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      #chatPage {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      #messageList {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      #messageInput,
      #sendMessageButton {
        padding: 10px;
      }

      #messageInput {
        width: calc(100% - 80px);
      }

      #sendMessageButton {
        width: 60px;
      }

      .deleteButton {
        margin-left: 10px;
        padding: 5px;
        background-color: red;
        color: white;
        border: none;
        cursor: pointer;
      }

      .deleteButton:hover {
        background-color: darkred;
      }

      .notification {
        background-color: #aa993e;
        padding: 10px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      #typingIndicator {
        display: none;
        font-style: italic;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div id="chatPage">
      <h2>Private Chat</h2>
      <div id="messageList"></div>
      <input type="text" id="messageInput" placeholder="Type a message..." />
      <button id="sendMessageButton">Sending</button>
      <div id="onlineIndicator" style="display:none;">User is Online</div>
      <div id="typingIndicator">User is typing...</div>
      <div id="notifications"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const socket = io("http://localhost:8000");
 
        const messageList = document.getElementById("messageList");
        const messageInput = document.getElementById("messageInput");
        const sendMessageButton = document.getElementById("sendMessageButton");
        const typingIndicator = document.getElementById("typingIndicator");
        const notifications = document.getElementById("notifications");

        const senderPhoneNumber = prompt( 
          "Enter your phone number:",
          "03071010563"
        );
        const receiverPhoneNumber = prompt(
          "Enter receiver's phone number:",
          "03439730850"
        );

        // Start chat
        socket.emit("startChat", { senderPhoneNumber, receiverPhoneNumber });
        console.log("Chat started", { senderPhoneNumber, receiverPhoneNumber });

        // Load previous messages
        socket.on("loadPrivateMessages", (messages) => {
          messageList.innerHTML = "";
          messages.forEach((msg) => {
            displayMessage(msg);
          });
          console.log(messages, "messages loaded");
        });

        socket.on("deleteMessage", ({ messageId }) => {
          const messageElement = messageList.querySelector(
            `[data-message-id="${messageId}"]`
          );
          if (messageElement) {
            messageList.removeChild(messageElement);
          }
          console.log(messageId, "message deleted");
        });



                // online events
                const onlineIndicator = document.getElementById('onlineIndicator');
    
    // Message input field
    const messageInputs = document.getElementById('messageInput');

    // When user enters the chat (page load or opening the screen)
    window.onload = () => {
      socket.emit('userConnect', senderPhoneNumber);  // User is now online
      console.log(`${senderPhoneNumber} connected to chat`);
    };

    // Notify the server when the user goes offline (closes the tab or leaves the page)
    window.onbeforeunload = () => {
      socket.emit('userDisconnect', senderPhoneNumber);  // User is now offline
      console.log(`${senderPhoneNumber} disconnected from chat`);
    };

    // Notify the server when the user is online (i.e., typing a message)
    messageInputs.addEventListener('input', () => {
      socket.emit('userConnect', senderPhoneNumber);
    });

    // Notify the server when the user goes offline (e.g., when the input loses focus)
    messageInputs.addEventListener('blur', () => {
      socket.emit('userDisconnect', senderPhoneNumber);
    });

    // Listen for the "userOnline" event from the server
    socket.on('userOnline', (onlinePhoneNumber) => {
      if (onlinePhoneNumber === receiverPhoneNumber) {
        onlineIndicator.style.display = 'block';  // Show the online indicator
        console.log(`${onlinePhoneNumber} is online`);
      }
    });

    // Listen for the "userOffline" event from the server
    socket.on('userOffline', (offlinePhoneNumber) => {
      if (offlinePhoneNumber === receiverPhoneNumber) {
        onlineIndicator.style.display = 'none';  // Hide the online indicator
        console.log(`${offlinePhoneNumber} went offline`);
      }
    });

    // Listen for socket disconnection
    socket.on('disconnect', () => {
      console.log('You have been disconnected from the server.');
    });

        // Typing events
        messageInput.addEventListener("input", () => {
          socket.emit("userTyping", { senderPhoneNumber, receiverPhoneNumber });
        });

        messageInput.addEventListener("blur", () => {
          socket.emit("userStoppedTyping", {
            senderPhoneNumber,
            receiverPhoneNumber,
          });
        });

        // Show typing indicator
        socket.on("typing", (typingSenderPhoneNumber) => {
          if (typingSenderPhoneNumber !== senderPhoneNumber) {
            typingIndicator.style.display = "block";
          }
        });

        // Hide typing indicator
        socket.on("stoppedTyping", (typingSenderPhoneNumber) => {
          if (typingSenderPhoneNumber !== senderPhoneNumber) {
            typingIndicator.style.display = "none";
          }
        });




        // Send message
        sendMessageButton.addEventListener("click", () => {
          const message = messageInput.value;
          if (message.trim() !== "") {
            socket.emit("sendPrivateMessage", {
              senderPhoneNumber,
              receiverPhoneNumber,
              message,
            });
            messageInput.value = "";
          }
          // console.log(message, "message sent");
        });

        // Display received private message
        socket.on("ReceivedPrivateMessage", (msg) => {
          displayMessage(msg);
          // console.log(msg, "message received");
        });

        // Show notification
        socket.on("notification", ({ senderPhoneNumber, message }) => {
          const notificationElement = document.createElement("div");
          notificationElement.className = "notification";
          notificationElement.textContent = `New private message from ${senderPhoneNumber}: ${message}`;

          // Append the notification to the UI (assuming 'notifications' is a valid DOM element)
          notifications.appendChild(notificationElement);

          // Log for debugging purposes
          console.log(
            `Notification received from ${senderPhoneNumber}: ${message}`
          );
        });

        // Function to display message in messageList
        function displayMessage(msg) {
          const messageElement = document.createElement("div");
          messageElement.textContent = `${msg.senderPhoneNumber}: ${msg.message}`;
          messageElement.setAttribute("data-message-id", msg.id);
          // console.log(msg, "message id: ", msg.id);

          // Create delete button
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.className = "deleteButton";
          deleteButton.onclick = () => {
            // Emit delete request to server
            socket.emit("deletePrivateMessage", {
              messageId: msg.id,
              senderPhoneNumber: msg.senderPhoneNumber,
            });
          };

          // Append message and delete button to message element
          messageElement.appendChild(deleteButton);
          messageList.appendChild(messageElement);
        }
      });
    </script>
    
  </body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat & Polls</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="chat-container">
    <div id="messages" class="messages"></div>

    <div id="polls" class="polls"></div>

    <div class="message-input">
      <input type="text" id="messageInput" placeholder="Enter your message..." />
      <button id="sendMessageBtn">Send Message</button>
    </div>

    <div class="poll-input">
      <input type="text" id="pollQuestion" placeholder="Enter poll question..." />
      <input type="text" id="pollOption1" placeholder="Option 1" />
      <input type="text" id="pollOption2" placeholder="Option 2" />
      <button id="createPollBtn">Create Poll</button>
    </div>

    <div class="vote-input">
      <select id="voteOptions">
        <option value="">Select Poll to Vote</option>
      </select>
      <button id="voteBtn">Vote</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  
  <script>
    // Connect to the backend
const socket = io('http://localhost:8000');  // Adjust this to match your server URL

// The group ID and user phone number should come from somewhere in your app
const groupId = 63;  // Example group ID
const userPhoneNumber = '03439730850';  // Example user phone number

// Join the group
socket.emit("joinGroup", { groupId, userPhoneNumber });

// Send a message (including polls)
document.getElementById('sendMessageBtn').addEventListener('click', () => {
  const message = document.getElementById('messageInput').value;
  
  if (message.trim() === "") return;

  socket.emit("sendMessage", { 
    groupId, 
    userPhoneNumber, 
    message,
    isPoll: false,  // This is a regular message
  });

  document.getElementById('messageInput').value = "";  // Clear input
});

// Create a poll
document.getElementById('createPollBtn').addEventListener('click', () => {
  const question = document.getElementById('pollQuestion').value;
  const option1 = document.getElementById('pollOption1').value;
  const option2 = document.getElementById('pollOption2').value;

  if (question.trim() === "" || option1.trim() === "" || option2.trim() === "") return;

  socket.emit("sendMessage", { 
    groupId, 
    userPhoneNumber, 
    message: question,
    isPoll: true, 
    options: [option1, option2]  // Poll options
  });

  document.getElementById('pollQuestion').value = "";
  document.getElementById('pollOption1').value = "";
  document.getElementById('pollOption2').value = "";
});

// Vote on a poll
document.getElementById('voteBtn').addEventListener('click', () => {
  // const selectedPollId = document.getElementById('voteOptions').value;
  const selectedOptionId = document.querySelector('input[name="voteOption"]:checked')?.value;

  if (!selectedOptionId){
    return(console.log("not select option!"))
  };

  socket.emit("votePoll", {
    groupId,
    userPhoneNumber,
    pollId: selectedPollId,
    optionId: selectedOptionId,
  });
});

// Receive messages (including polls)
socket.on("message", (message) => {
  const messagesDiv = document.getElementById('messages');
  const messageElement = document.createElement('div');
  messageElement.textContent = message.message;
  messagesDiv.appendChild(messageElement);
});

// Receive new polls
socket.on("newPoll", (data) => {
  const pollsDiv = document.getElementById('polls');
  const pollElement = document.createElement('div');
  console.log(data, '....................');
  pollElement.innerHTML = `
    <p>${data.message.message}</p>
    <div id="pollOptions${data.message.id}">
      ${data.options.map((option, index) => {
        return `<input type="radio" name="voteOption" value="${data.message.id}" /> ${option}<br>`;
        console.log(option, "option...........")
      }).join('')}
    </div>
    <button onclick="submitVote(${data.message.id})">Vote</button>
  `;
  pollsDiv.appendChild(pollElement);

  // Add poll to vote options dropdown
  // const voteOptionsSelect = document.getElementById('voteOptions');
  // const optionElement = document.createElement('option');
  // optionElement.value = data.message.id;
  // optionElement.textContent = data.message.message;
  // voteOptionsSelect.appendChild(optionElement);
});

// Receive poll results
socket.on("pollResults", (poll) => {
  console.log(poll, "polllll.......")
  const pollResultsDiv = document.getElementById('polls');
  const pollResultsElement = document.createElement('div');
  pollResultsElement.innerHTML = `
    <p><strong>${poll.message.message}</strong></p>
    <div>
      ${poll.PollOptions.map(option => {
        return `${option.option_text}: ${option.votes} votes<br>`;
        console.log(option, "''''''''''''''''")
      }).join('')}
    </div>
  `;
  pollResultsDiv.appendChild(pollResultsElement);
});

// Handle errors
socket.on("error", (errorMessage) => {
  alert(errorMessage);
});

  </script>
</body>
</html>



